"use strict";var readyFooterTop=function(){var obj=$('#avatar-header');if(obj.length){var src=system.path+'/ueditor/dialogs/emotion/images/ac/'+(1+$.rnd(50))+'.gif';var pts=$('#block-avatar-header').children('span.pts');var lines=[];obj.attr({src:src}).one('click.avatarheader',function(){system.timer.avatarHeader=new Date().getTime();$.get('/dotnet/date/text/lines/lines.txt').done(function(date){lines=date.replace(/\/\*[\s\S]*?\*\//g,'').replace(/\\r/g,'\n').replace(/\\n+/g,'\n').split('\n');if(!lines[0].length){lines.splice(0,1)}})}).click(function(){var img=$(this);var mid=$.mid();var a=parseInt(pts.text());a++;if(a%50==0){var line=lines.length?lines[$.rnd(lines.length)].replace(/\[name\]/g,user.online?user.name:'游客').replace(/\[time]/g,new Date().toLocaleString()):'少女祈祷中...';var apm=parseInt(a/((new Date().getTime()-system.timer.avatarHeader)/1000/60));if(apm<600){img.attr({src:system.path+'/ueditor/dialogs/emotion/images/ac/'+(1+$.rnd(50))+'.gif'}).info(line);$.info('连续点击了'+a+'次，APM为'+apm+'次/分。')}else{$.info('error::未知核弹已经升空。');img.ensure({text:'未知核弹已经升空。是否前往研究所避难？',curtain:true,callback:function(){window.location.href='/member/#area=lab'}})}};if(a==1){pts.removeClass('hidden')};pts.text(a).riseInfo('+1 click')})};var list=['location-search-index','location-report','location-map','location-style'];if($.inArray(system.location,list)<0){var a=$(window).innerWidth()||$('body').width();if(a>1100){var obj=$('#block-tool-footer');if(system.browser.cssanimations){$(window).bind('resize.blockToolFooter',function(){window.clearTimeout(system.timer.blockToolFooter);system.timer.blockToolFooter=window.setTimeout(function(){obj.css({top:$(window).innerHeight()-192,left:'auto',right:$('#header-inner').offset().left-64})},50)});window.setTimeout(function(){obj.css({top:$(window).innerHeight()-192,left:'auto',right:$('#header-inner').offset().left-64,position:'fixed'}).removeClass('hidden')},200)}else{$(window).bind('scroll.blockToolFooter',function(){window.clearTimeout(system.timer.blockToolFooter);system.timer.blockToolFooter=window.setTimeout(function(){var a=$(window).scrollTop()+($(window).innerHeight()||$('body').height())-240;obj.stop().animate({top:a},200,'easeOutCirc')},500)});obj.css({top:$(window).scrollTop()+($(window).innerHeight()||$('body').height())-240}).removeClass('hidden')}}}};var readyHeader=function(callback){var guide=$('#guide');var inner=$('#guide-inner');var list=['location-search-index','location-article'];if(system.browser.cssanimations){if(($.inArray(system.location,list)<0||system.type=='article')){if(!!config.globe.guideFloatAllowed){guide.css({position:'fixed'})}}};refreshHeader()};function refreshHeader(callback){var obj=$('#login-guide');if(user.online==1){var html=''+'<div id="at-guide" class="item-guide-top hidden" title="召唤"><a href="/member/#area=mention" target="_blank"><i class="icon gray icon-at">召唤</i><p class="pts">0</p></a></div>'+'<div id="push-guide" class="item-guide-top hidden" title="推送"><a href="/member/#area=push" target="_blank"><i class="icon gray icon-file">推送</i><p class="pts">0</p></a></div>'+'<div id="fan-guide" class="item-guide-top hidden" title="听众"><a href="/member/#area=followers" target="_blank"><i class="icon gray icon-user">听众</i><p class="pts">0</p></a></div>'+'<div id="mail-guide" class="item-guide-top hidden" title="私信"><a href="/member/#area=mail" target="_blank"><i class="icon gray icon-envelope">私信</i><p class="pts">0</p></a></div>'+'<div class="dropdown item-guide-top"><a id="hint-name-guide" href="/member/" target="_blank"><i class="icon gray icon-home"></i>'+(user.name.length<16?user.name:'用户中心')+'</a>'+'<ul class="menu menu-channel-guide">'+'<li><a id="btn-header-mail" target="_blank" href="/member/#area=mail"><i class="icon icon-envelope"></i>私信</a></li>'+'<li><a target="_blank" href="/member/#area=favourite"><i class="icon icon-folder-open"></i>收藏夹</a></li>'+'<li><a target="_blank" href="/member/#area=history"><i class="icon icon-book"></i>浏览历史</a></li>'+'<li><a href="/logout.aspx?returnUrl='+$.parseSafe(self.location.href)+'"><i class="icon icon-off"></i>退出登录</a></li>'+'</ul></div>'+'<div id="area-public-guide-top" class="item-guide-top">'+'<a id="btn-public-guide" class="btn success mini" target="_blank" href="/member/#area=post-'+(system.type&&system.type=='article'?'article':'simple')+'" title="提交投稿">投稿</a>'+'<a id="btn-public-guide" class="btn info mini" target="_blank" href="/feedback.aspx#from='+$.parseSafe(window.location.href.replace(/\#.*/,''))+'" title="提交您的意见或建议">反馈</a>'+'</div>';obj.html(html).find('div.dropdown').eq(0).setup();$('#btn-public-guide').click(function(e){if(system.type&&system.type=='picture'){e.preventDefault();window.open('/picture/quick-public-pic.aspx','','width=640, height=320, top='+(window.screen.height-320)*0.4+', left='+(window.screen.width-640)*0.5+', toolbar=no, menubar=no, scrollbars=no, location=yes, resizable=no, status=no')}else if(!system.type&&system.location=='location-style'){e.preventDefault();$('#btn-public-style').click()}});checkUnread();if($.isFunction(callback)){callback()}}else if(user.online==-1){window.setTimeout(function(){refreshHeader()},1000)}else{var html='<div id="area-public-guide-top" class="item-guide-top">'+'<a class="btn info mini" onClick="javascript:$(this).call(\'login\'); return false;" title="帐号登录">登录</a>'+'<a class="btn success mini" onClick="javascript:$(this).call(\'reg\');" title="帐号注册">注册</a>'+'</div>';obj.html(html);if($.isFunction(callback)){callback()}};$('#menu-location-guide-top').find('div.tabb').setup().find('span.tab').hover(function(){var tab=$(this);system.timer.guideMenuHover=window.setTimeout(function(){tab.click()},200)},function(){window.clearTimeout(system.timer.guideMenuHover)})};var checkUnread=function(){var func={name:'checkUnread()'};$.check('unread',function(){var list=['push','at','mail','fan'];for(var i=0,l=list.length;i<l;i++){if(user.unread&&user.unread[list[i]]){func[list[i]]=user.unread[list[i]];if(func[list[i]]>99){func[list[i]]='99+'};$('#'+list[i]+'-guide').removeClass('hidden').find('p.pts').text(func[list[i]])}else{func[list[i]]=0;$('#'+list[i]+'-guide').addClass('hidden')}}})};var bindSearchBar=function(para,callback){var func={name:'bindSearchBar()',placeholder:'搜索',html:'',callback:callback};var ipt=$(para);if(ipt.length){var block=ipt.parent();var mid=$.mid();ipt.val(func.placeholder).after('<button id="btn-'+mid+'" class="btn-search" title="搜索"><i class="icon icon-search">搜索</i></button><ul id="menu-'+mid+'" class="menu menu-search"></ul>');var dropdown=$('#menu-'+mid);dropdown.css({left:ipt.offset().left-block.offset().left,top:ipt.offset().top-block.offset().top+36,'min-width':ipt.width()+32+8+2});var btn=$('#btn-'+mid);btn.css({left:ipt.offset().left-block.offset().left+ipt.width()+16,top:ipt.offset().top-block.offset().top+(ipt.height()-22)*0.5}).click(function(e){var objAct=dropdown.children('li.active');if(objAct.length){e.preventDefault();var key=objAct.children('a').attr('href');self.location.href=key}else if(!ipt.val().length||$.trim(ipt.val())==func.placeholder){e.preventDefault();window.open('/search.aspx')}else{var key=encodeURI($.trim(ipt.val()).replace(/\s+/g,'+'));e.preventDefault();if(system.location=='location-search'){top.location.href='/search.aspx#query='+key}else{window.open('/search.aspx#query='+key)}}});ipt.focus(function(){if($(this).val()==func.placeholder){$(this).val("")};$(this).keyup();dropdown.css({display:'block',opacity:0}).stop().animate({opacity:1},200)}).blur(function(){if(!$.trim($(this).val()).length){$(this).val(func.placeholder)};dropdown.stop().animate({opacity:0},200,function(){dropdown.css({display:'none'})})}).keydown(function(e){if(e.which==13||e.which==108){btn.click();ipt.blur()}else if(e.which==38||e.which==40){e.preventDefault()}}).keyup(function(e){var objAct=dropdown.children('li.active');if(e.which==38||e.which==40){e.preventDefault();if(!objAct.length){if(e.which==38){dropdown.children('li:last').addClass('active')}else{dropdown.children('li:first').addClass('active')}}else{var mimikoIndex=e.which==38?objAct.index()-1:objAct.index()+1;mimikoIndex=mimikoIndex<0?dropdown.children('li').length-1:mimikoIndex;mimikoIndex=mimikoIndex>=dropdown.children('li').length?0:mimikoIndex;objAct.removeClass('active');dropdown.children('li:eq('+mimikoIndex+')').addClass('active')}}else if(e.which==37||e.which==39){}else{if(ipt.val().length){window.clearTimeout(system.timer.searchSuggestion);system.timer.searchSuggestion=window.setTimeout(function(){if(system.port.searchSuggestion){system.port.searchSuggestion.abort()};system.port.searchSuggestion=$.get('/automatch.aspx?query='+encodeURI($.trim(ipt.val()))).done(function(data){if(!!data.success){var a=data.jsonarr;func.html='';for(var i=0,l=!(system.location=='location-article'&&system.type=='video')?a.length:5;i<l;i++){var key=a[i]&&a[i].length>50?a[i].substr(0,50):a[i];func.html+='<li><a href="/search.aspx#query='+encodeURI(key)+'" target="_blank">'+key+'</a></li>'};dropdown.html(func.html)}else{func.html='<li><a href="http://wiki.acfun.tv/index.php/搜索" target="_blank">获取搜索帮助</a></li>';dropdown.html(func.html)}}).fail(function(){func.html='<li><a href="http://wiki.acfun.tv/index.php/搜索" target="_blank">获取搜索帮助</a></li>';dropdown.html(func.html)})},500)}else{func.html='<li><a href="http://wiki.acfun.tv/index.php/搜索" target="_blank">获取搜索帮助</a></li>';dropdown.html(func.html)}}});if($.isFunction(func.callback)){func.callback()}}else{$.info('debug::['+func.name+']不存在的非法元素。')}};var readyGuideFooter=function(){var block=$('#block-guide-footer');var area=block.find('div.l');if(system.location=='location-index'){}else if(system.location=='location-channel'){var cid=system.cid||system.channel;area.find('a').filter('[data-cid*="|'+cid+'|"]').eq(-1).addClass('active primary');block.removeClass('hidden')}else if(system.location=='location-article'){var cid=system.cid||system.channel;area.find('a').filter('[data-cid*="|'+cid+'|"]').eq(-1).addClass('active primary');block.removeClass('hidden')}else{}};system.func.first=function(){$('#win-info').bind('mouseenter',function(){window.clearTimeout(system.timer.card)}).bind('mouseleave',function(){var win=$(this);window.clearTimeout(system.timer.card);system.timer.card=window.setTimeout(function(){win.css({display:'none'})},200)});$('#area-window').delegate('div.win-hint','click',function(){var win=$(this);win.stop(false,true).animate({opacity:0},200,function(){win.css({display:'none'});if(!win.is('#win-hint')){win.remove()}})});$.check('login');bindSearchBar('#input-search-guide');$('#guide-inner div.dropdown').setup()};