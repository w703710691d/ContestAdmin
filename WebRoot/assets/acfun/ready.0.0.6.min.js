system.tv=function(){"use strict";system.func.ready=function(callback){$.readyStage(function(){system.tv=function(){if(!system.gate.globalThemeDisallowed&&config.globe.globalThemeAllowed){var html='<link id="style-theme-member" href="'+system.path+"/style/member/theme/"+(user.center.theme||"default")+"/theme.css?date="+system.date+'" rel="stylesheet">';$("head").append(html);if(config.globe.themeEffectAllowed){var checkTime=function(){var h=(new Date).getHours();if(h>=18||h<=6){$("#stage").addClass("time-night")}else{$("#stage").removeClass("time-night")}};window.setInterval(function(){checkTime()},3e5);checkTime();if(user.center.theme=="xmas"){$.getScript(system.path+"/script/jquery.snow.min.js?date="+system.date,function(){var p=1e3;var h=(new Date).getHours();if(h>=18||h<=6){p=500}$.fn.snow({interval:p})})}else if(user.center.theme=="feb14th"){$.getScript(system.path+"/script/jquery.snow.min.js?date="+system.date,function(){$.fn.snow({character:"♥",size:[16,32],interval:1e3,color:["#e4534f","#bc455b","#ca2f3b","#ec7675"],max:24})})}}}}();system.tv=function(){var mainer=$("#mainer");var stage=system.handle.stage;var f=function(){var h=mainer.height()+($(window).height()||$("body").height())-stage.height();if(h>0){mainer.css({"min-height":h})}};if(mainer.height()<($(window).height()||$("body").height())){$(window).resize("resize.heightFix",function(){f()});f()}}();system.tv=function(){$("#win-info").on("mouseenter",function(){window.clearTimeout(system.timer.card)}).on("mouseleave",function(){var win=$(this);window.clearTimeout(system.timer.card);system.timer.card=window.setTimeout(function(){win.css({display:"none"})},200)});$("#area-window").delegate("div.win-hint","click",function(){var win=$(this);win.stop(false,true).animate({opacity:0},200,function(){win.css({display:"none"});if(!win.is("#win-hint")){win.remove()}})})}();system.tv=function(){if(system.browser.rgba){var elem=$("#btn-top-shortcut");var obj=$("#footer-inner");var f=function(){elem.css({left:obj.offset().left+obj.width()+16}).removeClass("hidden")};elem.data({timer:null}).hoverInfo({type:"info"});$(window).resize(function(){window.clearTimeout(elem.data().timer);elem.data().timer=window.setTimeout(function(){f()},200)});f()}}();system.tv=function(){var guide=$("#guide");var inner=$("#guide-inner");var obj=$("#sub-guide");inner.children("div.l").children("a").not(".first").add("#area-user-guide, #btn-mail-guide, #btn-post-guide").hover(function(){var elem=$(this);if(elem.data().channel){obj.data({singer:elem}).mouseenter()}else{obj.addClass("hidden")}},function(){obj.mouseleave()});obj.data({timer:null}).hover(function(){window.clearTimeout(obj.data().timer);var singer=obj.data().singer;var o=obj.children("div.channel-"+singer.data().channel);if(o.length){var left=!o.hasClass("right")?singer.offset().left:"auto";var right=!o.hasClass("right")?"auto":inner.offset().left;o.removeClass("hidden").css({left:left,right:right}).siblings("div:not(.hidden)").addClass("hidden")}obj.removeClass("hidden")},function(){window.clearTimeout(obj.data().timer);obj.data().timer=window.setTimeout(function(){obj.addClass("hidden")},200)});$.check("login",function(){if(user.online){var elem=inner.find("div.after");elem.find("img.avatar").attr({src:user.avatar});elem.removeClass("hidden");var a=$("#a-logout-guide");a.attr({href:a.attr("href")+"?returnUrl="+$.parseSafe(self.location.href.toString().replace(/[\?\#].*/,""))});var checkUnread=function(){var btn=$("#btn-mail-guide");btn.data({timer:null});$.check("unread",function(){var a=user.unread;var list=["at","fan","mail","push"];var elem=[];for(var i=0,l=list.length;i<l;i++){elem.push($("#a-"+list[i]+"-guide"))}var sum=0;for(var i=0,l=list.length;i<l;i++){if(elem[i].length){sum+=a[list[i]];elem[i].children("span.pts").text("("+(a[list[i]]||0)+")").off("click").on("click",function(){if(btn.data().timer){window.clearTimeout(btn.data().timer)}btn.data().timer=window.setTimeout(function(){checkUnread()},1e4)})}}if(sum){btn.addClass("active").children("p.pts").text(sum)}else{btn.removeClass("active").children("p.pts").text(0)}})};checkUnread();window.setInterval(function(){checkUnread()},12e4)}else{inner.find("div.before").removeClass("hidden")}});if(system.location!="location-video"&&config.globe.guideFloatAllowed){guide.addClass("float")}}();window.setTimeout(function(){var func={name:"bindSearchBar()",elem:$("#area-search-guide"),placeholder:"搜索"};var form=func.elem;var ipt=form.find("input.ipt-search");var dropdown=form.find("ul.menu-search");if(ipt.length){form.data({timer:null,port:null});ipt.val(func.placeholder);dropdown.css({left:ipt.offset().left-form.offset().left,top:ipt.offset().top-form.offset().top+36,"min-width":ipt.width()+32+8+2}).delegate("a","click",function(){var obj=$(this);ipt.val(obj.find("span.cont").text())});ipt.focus(function(){if(ipt.val()==func.placeholder){ipt.val("")}ipt.keyup();dropdown.css({display:"block",opacity:0}).stop().animate({opacity:1},200)}).blur(function(){if(!$.trim(ipt.val()).length){ipt.val(func.placeholder)}dropdown.stop().animate({opacity:0},200,function(){dropdown.css({display:"none"})})}).keyup(function(e){var obj=dropdown.children("li.active");if(e.which==38||e.which==40){e.preventDefault();if(!obj.length){if(e.which==38){dropdown.children("li:last").addClass("active")}else{dropdown.children("li:first").addClass("active")}}else{var i=e.which==38?obj.index()-1:obj.index()+1;i=i<0?dropdown.children("li").length-1:i;i=i>=dropdown.children("li").length?0:i;obj.removeClass("active");dropdown.children("li:eq("+i+")").addClass("active")}ipt.val(dropdown.children("li.active").find("span.cont").text())}else{var val=$.trim(ipt.val());if(val.length){window.clearTimeout(form.data().timer);form.data().timer=window.setTimeout(function(){if(form.data().port){form.data().port.abort()}form.data().port=$.getScript("http://api.acfun.tv/search/automatch/tag?query="+encodeURI(val)).done(function(){var a=system.tv;if(a.length){func.html="";for(var i=0,l=!(system.location=="location-article"&&system.type=="video")?a.length:5;i<l;i++){func.html+='<li><a href="/search.aspx#query='+a[i].tag+'" target="_blank"><span class="cont">'+a[i].tag+'</span><span class="hint">约'+$.parsePts(a[i].refCount)+"个结果</span></a></li>"}dropdown.html(func.html)}else{func.html='<li><a href="http://wiki.acfun.tv/index.php/搜索" target="_blank">获取搜索帮助</a></li>';dropdown.html(func.html)}}).fail(function(){func.html='<li><a href="http://wiki.acfun.tv/index.php/搜索" target="_blank">获取搜索帮助</a></li>';dropdown.html(func.html)})},500)}else{func.html='<li><a href="http://wiki.acfun.tv/index.php/搜索" target="_blank">获取搜索帮助</a></li>';dropdown.html(func.html)}}})}else{$.info("debug::["+func.name+"]不存在的非法元素。")}},1e3);system.func.ready=null;$.isFunction(callback)&&callback()})}}();